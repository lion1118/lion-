```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸµ å¤å¤œçƒŸç« |æˆ‘æ°¸è¿œæ˜¯ä½ çš„å¤´å·ç²‰ä¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            height: 100vh;
            color: white;
            touch-action: none;
        }
        
        #canvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        /* ====== éŸ³ä¹å…ç•Œé¢ ====== */
        .voice-room {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mic-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 107, 107, 0.3);
        }
        
        .mic-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            animation: micPulse 2s ease-in-out infinite;
        }
        
        .room-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .room-title {
            font-size: 16px;
            font-weight: bold;
            color: #ffd166;
        }
        
        .room-audience {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* ====== è§’è‰²å¡ç‰‡ ====== */
        .character-cards {
            position: fixed;
            bottom: 120px;
            left: 0;
            right: 0;
            z-index: 100;
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 0 20px;
        }
        
        .character-card {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 15px;
            min-width: 150px;
            backdrop-filter: blur(10px);
            border: 2px solid;
            position: relative;
            overflow: hidden;
        }
        
        .character-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }
        
        #aobai-card {
            border-color: rgba(255, 107, 107, 0.5);
        }
        
        #aobai-card::before {
            background: linear-gradient(90deg, #ff6b6b, #ff8e53);
        }
        
        #lein-card {
            border-color: rgba(107, 179, 255, 0.5);
        }
        
        #lein-card::before {
            background: linear-gradient(90deg, #6bb3ff, #53c5ff);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .character-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .aobai-avatar {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
        }
        
        .lein-avatar {
            background: linear-gradient(45deg, #6bb3ff, #53c5ff);
        }
        
        .character-name {
            font-size: 16px;
            font-weight: bold;
        }
        
        .character-desc {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 2px;
        }
        
        .mood-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .mood-icon {
            font-size: 20px;
            transition: transform 0.3s;
        }
        
        .mood-text {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        /* ====== äº’åŠ¨æŒ‰é’® ====== */
        .interaction-panel {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
        }
        
        .interaction-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 24px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .interaction-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .interaction-btn:active {
            transform: scale(0.95);
        }
        
        .btn-1 { border: 2px solid #ff6b6b; }
        .btn-2 { border: 2px solid #6bb3ff; }
        .btn-3 { border: 2px solid #ffd166; }
        .btn-4 { border: 2px solid #a663cc; }
        
        .btn-label {
            position: absolute;
            bottom: -25px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            white-space: nowrap;
        }
        
        /* ====== å¯¹è¯æ¡† ====== */
        .dialogue-bubble {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            max-width: 300px;
            z-index: 200;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            font-size: 14px;
            line-height: 1.4;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .dialogue-bubble.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .dialogue-bubble::before {
            content: '';
            position: absolute;
            bottom: -8px;
            width: 16px;
            height: 16px;
            background: rgba(0, 0, 0, 0.9);
            transform: rotate(45deg);
        }
        
        .dialogue-owner {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .dialogue-content {
            font-size: 14px;
        }
        
        /* ====== æ­Œæ›²é¢æ¿ ====== */
        .song-panel {
            position: fixed;
            top: 90px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 15px;
            z-index: 100;
            min-width: 250px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 107, 107, 0.3);
        }
        
        .current-song {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .song-icon {
            font-size: 24px;
            color: #ff6b6b;
        }
        
        .song-info {
            flex: 1;
        }
        
        .song-title {
            font-size: 16px;
            font-weight: bold;
            color: #ffd166;
            margin-bottom: 5px;
        }
        
        .song-desc {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .song-history {
            max-height: 120px;
            overflow-y: auto;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .history-item {
            font-size: 12px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
        }
        
        .history-title {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .history-mood {
            color: rgba(255, 255, 255, 0.6);
        }
        
        /* ====== ç‰¹æ®Šæ—¶åˆ» ====== */
        .special-moment {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.9), rgba(255, 142, 83, 0.9));
            color: white;
            padding: 30px;
            border-radius: 20px;
            z-index: 300;
            text-align: center;
            min-width: 300px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 50px rgba(255, 107, 107, 0.3);
        }
        
        .special-moment.show {
            opacity: 1;
        }
        
        .moment-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .moment-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .moment-desc {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        /* ====== çƒŸèŠ±ç‰¹æ•ˆ ====== */
        .fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }
        
        /* ====== åŠ¨ç”»å®šä¹‰ ====== */
        @keyframes micPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0) scale(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-100px) scale(1); opacity: 0; }
        }
        
        @keyframes sparkle {
            0% { transform: rotate(0deg) scale(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: rotate(180deg) scale(1); opacity: 0; }
        }
        
        /* ====== å“åº”å¼è°ƒæ•´ ====== */
        @media (max-width: 768px) {
            .character-cards { flex-direction: column; align-items: center; }
            .interaction-panel { flex-wrap: wrap; justify-content: center; }
            .interaction-btn { width: 50px; height: 50px; font-size: 20px; }
            .song-panel { top: 80px; right: 10px; left: 10px; }
        }
    </style>
</head>
<body>
    <!-- ä¸»ç”»å¸ƒ -->
    <canvas id="canvas"></canvas>
    
    <!-- çƒŸèŠ±å®¹å™¨ -->
    <div class="fireworks-container" id="fireworksContainer"></div>
    
    <!-- éŸ³ä¹å…ç•Œé¢ -->
    <div class="voice-room">
        <div class="mic-status">
            <div class="mic-icon">ğŸ¤</div>
            <div class="room-info">
                <div class="room-title">é³Œæ‹œçš„è¯­éŸ³å…</div>
                <div class="room-audience">
                    <span>ğŸ‘¥ åœ¨çº¿å¬ä¼—:</span>
                    <span id="audienceCount">1</span>
                    <span>(â¤ï¸ å¤´å·ç²‰ä¸: é›·æ©)</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ­Œæ›²é¢æ¿ -->
    <div class="song-panel">
        <div class="current-song">
            <div class="song-icon">ğŸµ</div>
            <div class="song-info">
                <div class="song-title" id="currentSongTitle">æ­£åœ¨æ¼”å”±ï¼šã€Šå‹¾æŒ‡èµ·èª“ã€‹</div>
                <div class="song-desc" id="currentSongMood">ğŸ’• ç”œèœœæ—¶åˆ» | é›·æ©ä¸“å±ç‚¹æ­Œ</div>
            </div>
        </div>
        <div class="song-history">
            <div class="history-item">
                <span class="history-title">ã€Šå¤å¤œæœ€åçš„çƒŸç«ã€‹</span>
                <span class="history-mood">âœ¨ çºªå¿µæ—¶åˆ»</span>
            </div>
            <div class="history-item">
                <span class="history-title">ã€Šæœ€åä¸€é¦–æƒ…æ­Œã€‹</span>
                <span class="history-mood">ğŸ˜¢ åˆé‡å›å¿†</span>
            </div>
            <div class="history-item">
                <span class="history-title">ã€Šä»Šå¤œæœ‰é›¨ã€‹</span>
                <span class="history-mood">â˜”ï¸ ç›¸é‡</span>
            </div>
        </div>
    </div>
    
    <!-- è§’è‰²å¡ç‰‡ -->
    <div class="character-cards">
        <div class="character-card" id="aobai-card">
            <div class="card-header">
                <div class="character-avatar aobai-avatar">ğŸ¤</div>
                <div>
                    <div class="character-name" style="color: #ff6b6b;">é³Œæ‹œ</div>
                    <div class="character-desc">è¯­éŸ³å…æ­Œæ‰‹ | 23å² | ç™½ç¾Šåº§</div>
                </div>
            </div>
            <div class="mood-indicator">
                <div class="mood-icon" id="aobaiMoodIcon">ğŸ˜Š</div>
                <div class="mood-text" id="aobaiMoodText">å¿ƒæƒ…ä¸é”™</div>
            </div>
        </div>
        
        <div class="character-card" id="lein-card">
            <div class="card-header">
                <div class="character-avatar lein-avatar">ğŸŒŸ</div>
                <div>
                    <div class="character-name" style="color: #6bb3ff;">é›·æ©</div>
                    <div class="character-desc">å¤´å·ç²‰ä¸ | 22å² | å°„æ‰‹åº§</div>
                </div>
            </div>
            <div class="mood-indicator">
                <div class="mood-icon" id="leinMoodIcon">ğŸ˜</div>
                <div class="mood-text" id="leinMoodText">è¶…çº§å¼€å¿ƒ</div>
            </div>
        </div>
    </div>
    
    <!-- äº’åŠ¨æŒ‰é’® -->
    <div class="interaction-panel">
        <button class="interaction-btn btn-1" id="sendGiftBtn">
            ğŸ’
            <span class="btn-label">é€ç¤¼ç‰©</span>
        </button>
        <button class="interaction-btn btn-2" id="requestSongBtn">
            ğŸµ
            <span class="btn-label">ç‚¹æ­Œ</span>
        </button>
        <button class="interaction-btn btn-3" id="tellJokeBtn">
            ğŸ˜‚
            <span class="btn-label">é€—å¼€å¿ƒ</span>
        </button>
        <button class="interaction-btn btn-4" id="confessBtn">
            ğŸ’Œ
            <span class="btn-label">æ‚„æ‚„è¯</span>
        </button>
    </div>
    
    <!-- å¯¹è¯æ¡† -->
    <div class="dialogue-bubble" id="dialogueBubble"></div>
    
    <!-- ç‰¹æ®Šæ—¶åˆ»å¼¹çª— -->
    <div class="special-moment" id="specialMoment">
        <div class="moment-icon" id="momentIcon">ğŸ†</div>
        <div class="moment-title" id="momentTitle">ç‰¹æ®Šæ—¶åˆ»</div>
        <div class="moment-desc" id="momentDesc"></div>
    </div>

    <script>
    // ========== æ¸¸æˆæ•°æ® ==========
    const GAME_STATE = {
        relationship: {
            level: 1,
            intimacy: 50,
            trust: 50,
            understanding: 50
        },
        aobai: {
            mood: 70,
            energy: 80,
            affection: 30,
            songs: [],
            favoriteSongs: ['å‹¾æŒ‡èµ·èª“', 'å¤å¤œæœ€åçš„çƒŸç«', 'æœ€åä¸€é¦–æƒ…æ­Œ']
        },
        lein: {
            mood: 90,
            energy: 100,
            affection: 80,
            secretFeelings: 50
        },
        currentSong: null,
        specialMoments: [],
        dayCount: 1
    };
    
    // ========== çœŸå®æ­Œå• ==========
    const REAL_SONGS = [
        // åˆé‡ç³»åˆ—
        {
            id: 1,
            title: "æœ€åä¸€é¦–æƒ…æ­Œ",
            artist: "è‹ç›",
            mood: "melancholy",
            lyrics: "è¿™æ˜¯æœ€åä¸€é¦–æƒ…æ­Œï¼Œä¹Ÿæ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€é¦–æƒ…æ­Œ",
            unlockDay: 1,
            special: "firstMeeting"
        },
        {
            id: 2,
            title: "ä»Šå¤œæœ‰é›¨",
            artist: "é˜Ÿé•¿",
            mood: "rainy",
            lyrics: "ä»Šå¤œæœ‰é›¨ï¼Œæˆ‘åœ¨é›¨ä¸­ç­‰ä½ ",
            unlockDay: 1,
            special: "rainyNight"
        },
        // ç”œèœœæ—¶åˆ»
        {
            id: 3,
            title: "å‹¾æŒ‡èµ·èª“",
            artist: "æ´›å¤©ä¾/è¨€å’Œ",
            mood: "sweet",
            lyrics: "æ‹‰é’©ä¸ŠåŠä¸€ç™¾å¹´ä¸è®¸å˜ï¼Œéª—äººçš„æ˜¯å°ç‹—",
            unlockDay: 3,
            special: "promise"
        },
        {
            id: 4,
            title: "å¤å¤œæœ€åçš„çƒŸç«",
            artist: "å¼ é½å±±",
            mood: "romantic",
            lyrics: "ä½ åƒå¤å¤œæœ€åçš„çƒŸç«ï¼Œç…§äº®æˆ‘æ•´ä¸ªæ˜Ÿç©º",
            unlockDay: 5,
            special: "fireworks"
        },
        // æ·±æƒ…ç³»åˆ—
        {
            id: 5,
            title: "æ°´æ˜Ÿè®°",
            artist: "éƒ­é¡¶",
            mood: "deep",
            lyrics: "è¿˜è¦å¤šè¿œæ‰èƒ½è¿›å…¥ä½ çš„å¿ƒï¼Œè¿˜è¦å¤šä¹…æ‰èƒ½å’Œä½ æ¥è¿‘",
            unlockDay: 7
        },
        {
            id: 6,
            title: "å½¢å®¹",
            artist: "æ²ˆä»¥è¯š",
            mood: "gentle",
            lyrics: "å°±åƒæ˜¯é‚£ç°è‰²å¤©ç©ºä¸­çš„å°é›¨ï¼Œä¸‹ä¸‹åœåœä¸åŠ¨å£°è‰²æ·‹æ¹¿åœŸåœ°",
            unlockDay: 10
        },
        {
            id: 7,
            title: "ä¸‹é›¨å¤©",
            artist: "å—æ‹³å¦ˆå¦ˆ",
            mood: "cozy",
            lyrics: "ä¸‹é›¨å¤©äº†æ€ä¹ˆåŠï¼Œæˆ‘å¥½æƒ³ä½ ",
            unlockDay: 12
        },
        {
            id: 8,
            title: "æ’’é‡",
            artist: "å‡¯ç‘Ÿå–µ",
            mood: "passionate",
            lyrics: "æˆ‘æƒ³æŠ¬å¤´æš–é˜³æ˜¥è‰ï¼Œä½ ç»™æˆ‘ç®€å•æ‹¥æŠ±",
            unlockDay: 15
        },
        // ç‰¹åˆ«æ—¶åˆ»
        {
            id: 9,
            title: "å¥½æƒ³çˆ±è¿™ä¸ªä¸–ç•Œå•Š",
            artist: "åæ™¨å®‡",
            mood: "healing",
            lyrics: "æƒ³è¿‡ç¦»å¼€ï¼Œä»¥è¿™ç§æ–¹å¼å­˜åœ¨",
            unlockDay: 20,
            special: "healing"
        },
        {
            id: 10,
            title: "å‹‡æ°”",
            artist: "æ£‰å­",
            mood: "brave",
            lyrics: "æˆ‘çˆ±ä½ ï¼Œæ— ç•äººæµ·çš„æ‹¥æŒ¤",
            unlockDay: 25,
            special: "confession"
        }
    ];
    
    // ========== äººç‰©å¯¹è¯åº“ ==========
    const DIALOGUES = {
        // é³Œæ‹œçš„å¯¹è¯
        aobai: {
            happy: [
                "ä»Šå¤©å”±æ­ŒçŠ¶æ€è¶…å¥½ï¼è°¢è°¢é›·æ©ä¸€ç›´åœ¨ï½",
                "çœ‹åˆ°ä½ é€çš„ç¤¼ç‰©äº†ï¼Œå¥½å¯çˆ±ï¼ğŸ˜Š",
                "è¿™é¦–ã€Šå¤å¤œæœ€åçš„çƒŸç«ã€‹æ˜¯æˆ‘ä»¬ä¸€èµ·çœ‹çš„ç¬¬ä¸€ä¸ªå¤å¤©å‘¢",
                "è™½ç„¶æœ‰æ—¶å€™ä½ ç¬¨ç¬¨çš„ï¼Œä½†çœŸçš„å¾ˆè´´å¿ƒ",
                "æœ‰ä½ è¿™ä¸ªæœ‹å‹çœŸå¥½ï¼ŒçœŸçš„",
                "é›·æ©ä½ ä»Šå¤©å¥½æ´»è·ƒå‘€ï¼",
                "å”±å®Œè¿™é¦–ã€Šå‹¾æŒ‡èµ·èª“ã€‹æ„Ÿè§‰æ•´ä¸ªäººéƒ½å¼€å¿ƒäº†",
                "ä½ çš„æ”¯æŒæ˜¯æˆ‘å”±æ­Œçš„æœ€å¤§åŠ¨åŠ›ï¼",
                "æ¯æ¬¡çœ‹åˆ°ä½ çš„ç•™è¨€éƒ½å¥½æ¸©æš–",
                "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œå¿ƒæƒ…ä¹Ÿç‰¹åˆ«å¥½ï¼"
            ],
            annoyed: [
                "é›·æ©ï¼ä½ åˆä¹±å¼€ç©ç¬‘å•¦ï¼ğŸ˜ ",
                "ä¸è¦æ€»è¯´äº›å¥‡æ€ªçš„è¯å˜›...æˆ‘ä»¬æ˜¯å¥½æœ‹å‹å‘€",
                "ä»Šå¤©æœ‰ç‚¹ç´¯ï¼Œæƒ³å®‰é™å”±ä¼šå„¿æ­Œ",
                "ä½ é€çš„ç¤¼ç‰©å¤ªè´µé‡äº†ï¼Œæœ‹å‹ä¹‹é—´ä¸ç”¨è¿™æ ·çš„",
                "ä¸ºä»€ä¹ˆä½ æ€»è¯´è¿™äº›è¯...æ€ªä¸å¥½æ„æ€çš„",
                "ç°åœ¨ä¸æƒ³è¯´è¯å•¦...",
                "ä»Šå¤©å¿ƒæƒ…æœ‰ç‚¹å¤æ‚å‘¢",
                "è®©æˆ‘ä¸€ä¸ªäººé™é™...",
                "ä½ æœ€è¿‘æœ‰ç‚¹å¤ªçƒ­æƒ…äº†...",
                "æˆ‘ä»¬ä¿æŒç‚¹è·ç¦»å¥½å—ï¼Ÿ"
            ],
            touched: [
                "é›·æ©...è°¢è°¢ä½ é™ªæˆ‘èµ°è¿‡é‚£æ®µæœ€éš¾çš„æ—¥å­",
                "åªæœ‰ä½ è®°å¾—æˆ‘æ¯ä¸€é¦–æ­Œçš„æ„ä¹‰",
                "é›¨å¤œé‚£é¦–ã€Šæœ€åä¸€é¦–æƒ…æ­Œã€‹ï¼Œä½ æ˜¯ç¬¬ä¸€ä¸ªç‚¹æˆ‘æ­Œçš„äºº",
                "æœ‰æ—¶å€™è§‰å¾—ï¼Œæœ‰ä½ è¿™æ ·çš„æœ‹å‹ï¼Œå”±æ­Œéƒ½æ›´æœ‰æ„ä¹‰äº†",
                "è¿™é¦–ã€Šå‹¾æŒ‡èµ·èª“ã€‹ï¼Œæ˜¯å”±ç»™ä½ çš„æ‰¿è¯º",
                "ä½ æ˜¯æˆ‘è§è¿‡æœ€çœŸè¯šçš„ç²‰ä¸...",
                "æœ‰æ—¶å€™çœŸçš„ä¸çŸ¥é“è¯¥æ€ä¹ˆæ„Ÿè°¢ä½ ",
                "æœ‰ä½ åœ¨ï¼Œå”±æ­Œéƒ½ä¸å­¤å•äº†",
                "ä½ çš„æ¯ä¸€æ¡ç•™è¨€æˆ‘éƒ½è®¤çœŸçœ‹äº†",
                "è°¢è°¢ä½ ä¸€ç›´ç›¸ä¿¡æˆ‘..."
            ],
            confused: [
                "é›·æ©ä»Šå¤©æ€ä¹ˆæ€ªæ€ªçš„...",
                "ä½ æœ€è¿‘æ€»æ˜¯æ¬²è¨€åˆæ­¢çš„æ ·å­",
                "æˆ‘ä»¬åªæ˜¯å¥½æœ‹å‹ï¼Œå¯¹å§ï¼Ÿ",
                "æœ‰æ—¶å€™ä½ çš„å…³å¿ƒ...è®©æˆ‘æœ‰ç‚¹ä¸çŸ¥æ‰€æª",
                "ä¸è¦å¯¹æˆ‘å¤ªå¥½ï¼Œæˆ‘ä¼šå®³æ€•å¤±å»",
                "ä½ åˆ°åº•æƒ³è¯´ä»€ä¹ˆå‘¢ï¼Ÿ",
                "æˆ‘æ„Ÿè§‰ä½ åœ¨éšç’ä»€ä¹ˆ...",
                "æˆ‘ä»¬è¿™æ ·çš„å…³ç³»å°±æŒºå¥½çš„...",
                "ä½ æœ€è¿‘çœ‹æˆ‘çš„çœ¼ç¥æœ‰ç‚¹ä¸ä¸€æ ·",
                "ä½ æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆè¯è¦å¯¹æˆ‘è¯´ï¼Ÿ"
            ]
        },
        
        // é›·æ©çš„å¯¹è¯
        lein: {
            adoring: [
                "é³Œæ‹œçš„å£°éŸ³æ˜¯ä¸–ç•Œä¸Šæœ€ç¾çš„ï¼ğŸ˜",
                "ä»Šå¤©ä¹Ÿä¸ºäº†å¬ä½ å”±æ­Œæ¥çš„ï½",
                "ä½ å”±ã€Šå‹¾æŒ‡èµ·èª“ã€‹çš„æ—¶å€™ï¼Œå¿ƒè·³éƒ½æ¼äº†ä¸€æ‹",
                "æƒ³ä¸ºä½ æ‰¿åŒ…æ•´ä¸ªè¯­éŸ³å…çš„ç¤¼ç‰©æ¦œï¼",
                "ä½ çš„æ¯é¦–æ­Œæˆ‘éƒ½ä¼šå¬ä¸€åƒé",
                "ä»Šå¤©ä¹Ÿè¦ä¸ºé³Œæ‹œæ‰“callï¼",
                "ä½ çš„æ­Œå£°å°±æ˜¯æˆ‘çš„èƒ½é‡ï¼",
                "å¬ç€ä½ å”±æ­Œï¼Œä»€ä¹ˆçƒ¦æ¼éƒ½æ²¡äº†",
                "ä½ å”±ä»€ä¹ˆæ­Œæˆ‘éƒ½å–œæ¬¢ï¼",
                "æ°¸è¿œæ”¯æŒé³Œæ‹œï¼"
            ],
            nervous: [
                "é‚£ä¸ª...é³Œæ‹œï¼Œæˆ‘æœ‰è¯æƒ³å¯¹ä½ è¯´...",
                "ä»Šå¤©æ˜¯ä¸æ˜¯åˆè¯´é”™è¯æƒ¹ä½ ç”Ÿæ°”äº†",
                "åªæ˜¯æœ‹å‹...å—ï¼Ÿå¯æ˜¯æˆ‘æƒ³...",
                "å¥½æƒ³å‘Šè¯‰ä½ æˆ‘çš„å¿ƒæ„ï¼Œä½†åˆæ€•å¤±å»ä½ ",
                "çœ‹ç€ä½ ç¬‘ï¼Œæˆ‘å°±è§‰å¾—ä¸–ç•Œéƒ½äº®äº†",
                "æˆ‘æ˜¯ä¸æ˜¯å¤ªé»ç€ä½ äº†ï¼Ÿ",
                "ä½ å¯¹æˆ‘åˆ°åº•æ˜¯ä»€ä¹ˆæ„Ÿè§‰å‘¢ï¼Ÿ",
                "å¥½æƒ³ç¦»ä½ æ›´è¿‘ä¸€ç‚¹...",
                "ä½ æ˜¯ä¸æ˜¯åœ¨èº²ç€æˆ‘ï¼Ÿ",
                "æˆ‘çš„å¿ƒæ„ï¼Œä½ èƒ½æ„Ÿè§‰åˆ°å—ï¼Ÿ"
            ],
            caring: [
                "ç´¯äº†å—ï¼Ÿè¦æ³¨æ„ä¼‘æ¯å“¦",
                "ä¸ç®¡å‘ç”Ÿä»€ä¹ˆï¼Œæˆ‘éƒ½ä¼šæ”¯æŒä½ ",
                "ä½ çš„æ¢¦æƒ³å°±æ˜¯æˆ‘çš„æ¢¦æƒ³",
                "ä»Šå¤©ä¸‹é›¨äº†ï¼Œè®°å¾—å¸¦ä¼",
                "è¦æŒ‰æ—¶åƒé¥­ï¼Œä¸è¦æ€»ç†¬å¤œç»ƒæ­Œ",
                "å—“å­ä¸èˆ’æœå°±å°‘å”±ç‚¹æ­Œ",
                "æœ‰ä»€ä¹ˆçƒ¦æ¼å¯ä»¥è·Ÿæˆ‘è¯´",
                "æˆ‘ä¼šä¸€ç›´åœ¨è¿™é‡Œç­‰ä½ ",
                "è®°å¾—å¤šå–æ°´ä¿æŠ¤å—“å­",
                "åˆ«å¤ªæ‹¼äº†ï¼Œèº«ä½“æœ€é‡è¦"
            ],
            playful: [
                "é³Œæ‹œï½ç¬‘ä¸€ä¸ªå˜›ï¼ğŸ˜œ",
                "çŒœçŒœæˆ‘ä»Šå¤©ç»™ä½ å‡†å¤‡äº†ä»€ä¹ˆæƒŠå–œï¼Ÿ",
                "è¦ä¸è¦å¬ä¸ªç¬‘è¯ï¼Ÿä¿è¯è®©ä½ ç¬‘å‡ºå£°ï¼",
                "ä»Šå¤©ä¹Ÿæ˜¯è¶…çº§å–œæ¬¢é³Œæ‹œçš„ä¸€å¤©ï¼",
                "ä½ ç”Ÿæ°”çš„æ ·å­ä¹Ÿå¥½å¯çˆ±å•Šï½",
                "æˆ‘ä»¬æ¥ç©ä¸ªæ¸¸æˆå§ï¼",
                "ä»Šå¤©æœ‰æ²¡æœ‰æƒ³æˆ‘å‘€ï¼Ÿ",
                "æˆ‘æœ‰ä¸ªç§˜å¯†è¦å‘Šè¯‰ä½ ï½",
                "ä½ è§‰å¾—æˆ‘ä»Šå¤©æ€ä¹ˆæ ·ï¼Ÿ",
                "æˆ‘ä»¬æ¥åˆå”±ä¸€é¦–æ­Œå§ï¼"
            ]
        }
    };
    
    // ========== ç¬‘è¯åº“ ==========
    const JOKES = [
        "ä¸ºä»€ä¹ˆæ­Œæ‰‹è¿‡é©¬è·¯è¦æˆ´è€³æœºï¼Ÿå› ä¸ºè¦å¬çº¢ç»¿ç¯çš„èŠ‚å¥ï¼",
        "é³Œæ‹œä½ çŸ¥é“ä¸ºä»€ä¹ˆéŸ³ä¹å…çš„WiFiä¿¡å·æœ€å¥½å—ï¼Ÿå› ä¸ºéŸ³ç¬¦ä¼šä¼ æ’­ä¿¡å·ï¼",
        "å¦‚æœæˆ‘æ˜¯éŸ³ç¬¦ï¼Œä½ å°±æ˜¯æˆ‘çš„è°ƒå·ï¼Œè®©æˆ‘æ•´ä¸ªäººéƒ½èµ°è°ƒäº†ï½",
        "é›·æ©ï¼šæˆ‘æƒ³ç‚¹ä¸€é¦–æ­Œ é³Œæ‹œï¼šä»€ä¹ˆæ­Œï¼Ÿ é›·æ©ï¼šæˆ‘ä»¬çš„ä¸»é¢˜æ›²ã€Šå¥½æœ‹å‹ã€‹",
        "ä¸ºä»€ä¹ˆæˆ‘æ€»æ¥å¬ä½ å”±æ­Œï¼Ÿå› ä¸ºä½ çš„å£°éŸ³æ¯”å’–å•¡è¿˜æç¥ï¼",
        "é³Œæ‹œï¼šä»Šå¤©å”±ä»€ä¹ˆå¥½å‘¢ï¼Ÿ é›·æ©ï¼šå”±ã€Šä¸ºä»€ä¹ˆé›·æ©è¿™ä¹ˆå¯çˆ±ã€‹",
        "å¦‚æœå”±æ­Œèƒ½å‘ç”µï¼Œé³Œæ‹œä½ ä¸€ä¸ªäººå°±èƒ½ç‚¹äº®æ•´ä¸ªåŸå¸‚ï¼",
        "ä½ è§‰å¾—æˆ‘åƒä»€ä¹ˆæ­Œï¼Ÿæˆ‘è§‰å¾—æˆ‘åƒã€Šæœ‰ç‚¹ç”œã€‹ï½",
        "ä½ çŸ¥é“ä»€ä¹ˆæ­Œæœ€é€‚åˆæˆ‘å—ï¼Ÿã€Šç¦»ä¸å¼€ä½ ã€‹ï¼",
        "ä½ çŒœæˆ‘ç°åœ¨åœ¨æƒ³ä»€ä¹ˆï¼Ÿåœ¨æƒ³ä½ å‘€ï¼"
    ];
    
    // ========== ç‰¹æ®Šæ—¶åˆ»è®°å¿† ==========
    const SPECIAL_MOMENTS = [
        {
            id: 1,
            title: "é›¨å¤œåˆé‡",
            description: "é‚£ä¸ªä¸‹é›¨çš„å¤œæ™šï¼Œé›·æ©ç¬¬ä¸€æ¬¡ç‚¹è¿›é³Œæ‹œçš„è¯­éŸ³å…",
            song: "æœ€åä¸€é¦–æƒ…æ­Œ",
            icon: "â˜”ï¸"
        },
        {
            id: 2,
            title: "å¤å¤œçƒŸç«",
            description: "ä¸€èµ·çœ‹çƒŸèŠ±çš„å¤œæ™šï¼Œé³Œæ‹œå”±äº†ã€Šå¤å¤œæœ€åçš„çƒŸç«ã€‹",
            song: "å¤å¤œæœ€åçš„çƒŸç«",
            icon: "ğŸ†"
        },
        {
            id: 3,
            title: "å‹¾æŒ‡çº¦å®š",
            description: "é›·æ©ç”Ÿæ—¥é‚£å¤©ï¼Œé³Œæ‹œä¸ºå¥¹å”±äº†ã€Šå‹¾æŒ‡èµ·èª“ã€‹",
            song: "å‹¾æŒ‡èµ·èª“",
            icon: "ğŸ¤"
        },
        {
            id: 4,
            title: "é‡é€¢",
            description: "é³Œæ‹œçœ¼ç›ç–¼åç¬¬ä¸€æ¬¡å¤å‡ºï¼Œåˆå”±äº†ã€Šä»Šå¤œæœ‰é›¨ã€‹",
            song: "ä»Šå¤œæœ‰é›¨",
            icon: "ğŸŒ§ï¸"
        }
    ];
    
    // ========== ç²’å­ç³»ç»Ÿ ==========
    let particles = [];
    let canvas, ctx;
    
    class Particle {
        constructor(x, y, type, color, targetX, targetY) {
            this.x = x;
            this.y = y;
            this.type = type; // 'heart', 'music', 'sparkle', 'firework'
            this.color = color;
            this.targetX = targetX;
            this.targetY = targetY;
            this.size = Math.random() * 8 + 4;
            this.speed = Math.random() * 3 + 2;
            this.life = 100;
            this.maxLife = 100;
            this.rotation = Math.random() * Math.PI * 2;
            this.rotationSpeed = (Math.random() - 0.5) * 0.1;
        }
        
        update() {
            if (this.targetX && this.targetY) {
                const dx = this.targetX - this.x;
                const dy = this.targetY - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 10) {
                    this.x += (dx / distance) * this.speed;
                    this.y += (dy / distance) * this.speed;
                }
            } else {
                this.y -= this.speed;
                this.x += Math.sin(this.life * 0.1) * 2;
            }
            
            this.life--;
            this.rotation += this.rotationSpeed;
            
            return this.life > 0;
        }
        
        draw() {
            ctx.save();
            ctx.globalAlpha = this.life / this.maxLife;
            
            switch(this.type) {
                case 'heart':
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    for(let i=0; i<Math.PI*2; i+=0.01) {
                        const px = 16 * Math.pow(Math.sin(i), 3);
                        const py = -(13 * Math.cos(i) - 5*Math.cos(2*i) - 2*Math.cos(3*i) - Math.cos(4*i));
                        ctx.lineTo(this.x + px * this.size/30, this.y + py * this.size/30);
                    }
                    ctx.fill();
                    break;
                    
                case 'music':
                    ctx.fillStyle = this.color;
                    ctx.font = `${this.size * 2}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('â™ª', this.x, this.y);
                    break;
                    
                case 'sparkle':
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                    break;
            }
            
            ctx.restore();
        }
    }
    
    // ========== æ¸¸æˆåŠŸèƒ½å‡½æ•° ==========
    function showDialogue(character, text, duration = 2500) { // ç¼©çŸ­ä¸º2.5ç§’
        const bubble = document.getElementById('dialogueBubble');
        bubble.innerHTML = `
            <div class="dialogue-owner">
                <span style="color: ${character === 'aobai' ? '#ff6b6b' : '#6bb3ff'}">
                    ${character === 'aobai' ? 'ğŸ¤ é³Œæ‹œ' : 'ğŸŒŸ é›·æ©'}
                </span>
            </div>
            <div class="dialogue-content">${text}</div>
        `;
        
        // ä½ç½®è°ƒæ•´
        if (character === 'aobai') {
            bubble.style.left = '20px';
            bubble.style.right = 'auto';
            bubble.style.bottom = '200px';
            bubble.style.transform = 'translateY(0)';
            bubble.style.opacity = '0';
        } else {
            bubble.style.left = 'auto';
            bubble.style.right = '20px';
            bubble.style.bottom = '200px';
            bubble.style.transform = 'translateY(0)';
            bubble.style.opacity = '0';
        }
        
        bubble.classList.add('show');
        
        setTimeout(() => {
            bubble.classList.remove('show');
        }, duration);
    }
    
    function updateMood() {
        const aobaiMoods = ['ğŸ˜ ', 'ğŸ˜', 'ğŸ˜Š', 'ğŸ˜'];
        const leinMoods = ['ğŸ˜¢', 'ğŸ˜', 'ğŸ˜Š', 'ğŸ˜'];
        
        const aobaiMood = Math.floor(GAME_STATE.aobai.mood / 25);
        const leinMood = Math.floor(GAME_STATE.lein.mood / 25);
        
        document.getElementById('aobaiMoodIcon').textContent = aobaiMoods[aobaiMood];
        document.getElementById('leinMoodIcon').textContent = leinMoods[leinMood];
        
        // å¿ƒæƒ…æ–‡å­—
        const moodTexts = {
            aobai: ['ç”Ÿæ°”ä¸­', 'å¿ƒæƒ…ä¸€èˆ¬', 'å¿ƒæƒ…ä¸é”™', 'è¶…çº§å¼€å¿ƒ'],
            lein: ['æœ‰ç‚¹éš¾è¿‡', 'å¿ƒæƒ…å¹³é™', 'å¾ˆå¼€å¿ƒ', 'å¹¸ç¦æ»¡æ»¡']
        };
        
        document.getElementById('aobaiMoodText').textContent = moodTexts.aobai[aobaiMood];
        document.getElementById('leinMoodText').textContent = moodTexts.lein[leinMood];
        
        // æ›´æ–°å¡ç‰‡é¢œè‰²
        const aobaiCard = document.getElementById('aobai-card');
        const leinCard = document.getElementById('lein-card');
        
        const aobaiOpacity = 0.3 + (GAME_STATE.aobai.mood / 100) * 0.4;
        const leinOpacity = 0.3 + (GAME_STATE.lein.mood / 100) * 0.4;
        
        aobaiCard.style.borderColor = `rgba(255, 107, 107, ${aobaiOpacity})`;
        leinCard.style.borderColor = `rgba(107, 179, 255, ${leinOpacity})`;
    }
    
    function createParticleEffect(type, count, sourceX, sourceY, targetX, targetY) {
        const colors = {
            heart: ['#ff6b6b', '#ff8e53', '#ffd166'],
            music: ['#6bb3ff', '#53c5ff', '#4ecdc4'],
            sparkle: ['#ffffff', '#ffd166', '#a663cc']
        };
        
        for (let i = 0; i < count; i++) {
            const color = colors[type][Math.floor(Math.random() * colors[type].length)];
            particles.push(new Particle(
                sourceX + Math.random() * 40 - 20,
                sourceY + Math.random() * 40 - 20,
                type,
                color,
                targetX + Math.random() * 60 - 30,
                targetY + Math.random() * 60 - 30
            ));
        }
    }
    
    function singRandomSong() {
        const availableSongs = REAL_SONGS.filter(song => 
            song.unlockDay <= GAME_STATE.dayCount
        );
        
        if (availableSongs.length === 0) return;
        
        const song = availableSongs[Math.floor(Math.random() * availableSongs.length)];
        GAME_STATE.currentSong = song;
        
        // æ›´æ–°UI
        document.getElementById('currentSongTitle').textContent = `æ­£åœ¨æ¼”å”±ï¼šã€Š${song.title}ã€‹`;
        
        const moodMap = {
            melancholy: 'ğŸ˜¢ æ·±æƒ…æ¼”å”±',
            rainy: 'â˜”ï¸ é›¨å¤œæƒ…æ­Œ',
            sweet: 'ğŸ’• ç”œèœœæ—¶åˆ»',
            romantic: 'âœ¨ æµªæ¼«æ°›å›´',
            deep: 'ğŸ’– èµ°å¿ƒæ¼”ç»',
            gentle: 'ğŸŒ¸ æ¸©æŸ”å¦‚æ°´',
            cozy: 'ğŸ¡ æ¸©é¦¨æ²»æ„ˆ',
            passionate: 'ğŸ”¥ çƒ­æƒ…å¥”æ”¾',
            healing: 'ğŸŒ± æ²»æ„ˆæ—¶åˆ»',
            brave: 'ğŸ¦¸ å‹‡æ•¢å‘Šç™½'
        };
        
        document.getElementById('currentSongMood').textContent = 
            `${moodMap[song.mood] || 'ğŸµ ç”¨å¿ƒæ¼”å”±'} | ${song.artist}`;
        
        // æ·»åŠ å¿ƒæƒ…å½±å“
        let moodChange = 0;
        let intimacyChange = 0;
        
        switch(song.mood) {
            case 'sweet':
            case 'romantic':
                moodChange = 10;
                intimacyChange = 5;
                if (song.special === 'promise' || song.special === 'fireworks') {
                    showSpecialMoment(song.special);
                }
                break;
            case 'melancholy':
            case 'rainy':
                moodChange = -5;
                intimacyChange = 3;
                if (song.special === 'firstMeeting' || song.special === 'rainyNight') {
                    showSpecialMoment(song.special);
                }
                break;
            default:
                moodChange = 5;
                intimacyChange = 2;
        }
        
        GAME_STATE.aobai.mood = Math.max(0, Math.min(100, GAME_STATE.aobai.mood + moodChange));
        GAME_STATE.relationship.intimacy = Math.min(100, GAME_STATE.relationship.intimacy + intimacyChange);
        
        // ç”ŸæˆéŸ³ä¹ç²’å­
        createParticleEffect('music', 20, 
            window.innerWidth / 2, 100,
            window.innerWidth / 2, window.innerHeight / 2
        );
        
        // éšæœºå¯¹è¯ - æ¯æ¬¡éƒ½å¿…å®šè§¦å‘
        const dialogues = DIALOGUES.aobai.happy.concat(DIALOGUES.aobai.touched);
        const randomDialogue = dialogues[Math.floor(Math.random() * dialogues.length)];
        
        setTimeout(() => {
            showDialogue('aobai', randomDialogue);
            
            // å¢åŠ é›·æ©çš„å›åº”ï¼ˆ80%æ¦‚ç‡ï¼‰
            if (Math.random() > 0.2) {
                setTimeout(() => {
                    const leinReactions = DIALOGUES.lein.adoring.concat(DIALOGUES.lein.caring);
                    const leinReaction = leinReactions[Math.floor(Math.random() * leinReactions.length)];
                    showDialogue('lein', leinReaction);
                }, 1200);
            }
        }, 800); // ç¼©çŸ­ç­‰å¾…æ—¶é—´
        
        updateMood();
        
        return song;
    }
    
    function showSpecialMoment(type) {
        const moment = SPECIAL_MOMENTS.find(m => 
            (type === 'firstMeeting' && m.id === 1) ||
            (type === 'rainyNight' && m.id === 4) ||
            (type === 'fireworks' && m.id === 2) ||
            (type === 'promise' && m.id === 3)
        );
        
        if (!moment || GAME_STATE.specialMoments.includes(moment.id)) return;
        
        GAME_STATE.specialMoments.push(moment.id);
        
        const momentElement = document.getElementById('specialMoment');
        document.getElementById('momentIcon').textContent = moment.icon;
        document.getElementById('momentTitle').textContent = moment.title;
        document.getElementById('momentDesc').textContent = moment.description;
        
        momentElement.classList.add('show');
        
        // çƒŸèŠ±æ•ˆæœ
        if (type === 'fireworks') {
            createFireworks();
        }
        
        setTimeout(() => {
            momentElement.classList.remove('show');
        }, 3500); // ç¼©çŸ­æ˜¾ç¤ºæ—¶é—´
    }
    
    function createFireworks() {
        const container = document.getElementById('fireworksContainer');
        
        for (let i = 0; i < 5; i++) {
            setTimeout(() => {
                const firework = document.createElement('div');
                firework.style.cssText = `
                    position: absolute;
                    width: 4px;
                    height: 4px;
                    background: ${['#ff6b6b', '#ffd166', '#6bb3ff', '#a663cc'][i % 4]};
                    border-radius: 50%;
                    left: ${20 + i * 20}%;
                    top: 80%;
                    animation: floatUp 2s ease-out forwards;
                    box-shadow: 0 0 10px currentColor;
                `;
                container.appendChild(firework);
                
                // çˆ†ç‚¸æ•ˆæœ
                setTimeout(() => {
                    for (let j = 0; j < 30; j++) {
                        const spark = document.createElement('div');
                        const angle = (j / 30) * Math.PI * 2;
                        const distance = 50 + Math.random() * 50;
                        spark.style.cssText = `
                            position: absolute;
                            width: 3px;
                            height: 3px;
                            background: inherit;
                            border-radius: 50%;
                            left: ${20 + i * 20}%;
                            top: 30%;
                            animation: sparkle 1.5s ease-out forwards;
                            transform-origin: center;
                        `;
                        spark.style.setProperty('--angle', angle);
                        spark.style.setProperty('--distance', distance);
                        container.appendChild(spark);
                        
                        setTimeout(() => spark.remove(), 1500);
                    }
                    
                    setTimeout(() => firework.remove(), 2000);
                }, 1000);
            }, i * 300);
        }
    }
    
    // ========== äº’åŠ¨å‡½æ•° - å¢å¼ºç‰ˆ ==========
    function sendGift() {
        // é›·æ©é€ç¤¼
        const gifts = [
            { name: "è™šæ‹Ÿç«ç‘°", value: 5, emoji: "ğŸŒ¹" },
            { name: "æ˜Ÿæ˜Ÿé¡¹é“¾", value: 10, emoji: "â­" },
            { name: "å®šåˆ¶éº¦å…‹é£", value: 20, emoji: "ğŸ¤" },
            { name: "æ˜Ÿç©ºæŠ•å½±ç¯", value: 15, emoji: "ğŸŒŒ" },
            { name: "çˆ±å¿ƒä¾¿å½“", value: 8, emoji: "ğŸ±" },
            { name: "æ¸©æš–å›´å·¾", value: 12, emoji: "ğŸ§£" }
        ];
        
        const gift = gifts[Math.floor(Math.random() * gifts.length)];
        
        // ç”Ÿæˆçˆ±å¿ƒç²’å­
        createParticleEffect('heart', 20,
            window.innerWidth * 0.8, window.innerHeight * 0.7,
            window.innerWidth * 0.2, window.innerHeight * 0.7
        );
        
        // æ›´æ–°çŠ¶æ€
        GAME_STATE.aobai.mood += gift.value;
        GAME_STATE.lein.affection += 3;
        GAME_STATE.relationship.intimacy += 2;
        
        // å¯¹è¯ååº” - å¢åŠ æ›´å¤šè½®æ¬¡
        showDialogue('lein', 
            `é€ç»™ä½ ${gift.emoji}${gift.name}ï¼å¸Œæœ›ä½ å–œæ¬¢ï½`, 
            2000
        );
        
        setTimeout(() => {
            if (GAME_STATE.aobai.affection < 50) {
                showDialogue('aobai', 
                    `è°¢è°¢é›·æ©çš„${gift.emoji}${gift.name}...ä½†æ˜¯å¤ªç ´è´¹äº†`, 
                    2500
                );
                GAME_STATE.aobai.affection += 2;
            } else {
                showDialogue('aobai', 
                    `åˆæ”¶åˆ°${gift.emoji}${gift.name}äº†ï¼é›·æ©ä½ çœŸæ˜¯çš„ï½`, 
                    2500
                );
                GAME_STATE.aobai.mood += 5;
            }
        }, 1200);
        
        // å¢åŠ åç»­å¯¹è¯ï¼ˆ60%æ¦‚ç‡ï¼‰
        if (Math.random() > 0.4) {
            setTimeout(() => {
                showDialogue('lein', "åªè¦ä½ å¼€å¿ƒå°±å¥½ï¼", 2000);
                
                // å†æ¬¡å›åº”ï¼ˆ40%æ¦‚ç‡ï¼‰
                if (Math.random() > 0.6) {
                    setTimeout(() => {
                        showDialogue('aobai', "ä½ æ€»æ˜¯è¿™ä¹ˆè´´å¿ƒ...", 2000);
                    }, 1500);
                }
            }, 2500);
        }
        
        updateMood();
    }
    
    function requestSong() {
        // é›·æ©ç‚¹æ­Œ
        const availableSongs = REAL_SONGS.filter(song => 
            song.unlockDay <= GAME_STATE.dayCount
        );
        
        if (availableSongs.length === 0) return;
        
        const song = availableSongs[Math.floor(Math.random() * availableSongs.length)];
        
        // ç‰¹æ®Šæ­Œæ›²å¤„ç†
        if (song.special === 'confession' && GAME_STATE.lein.secretFeelings < 70) {
            showDialogue('lein', "é‚£é¦–æ­Œ...è¿˜ä¸åˆ°æ—¶å€™ç‚¹", 2000);
            return;
        }
        
        showDialogue('lein', 
            `æˆ‘æƒ³å¬ã€Š${song.title}ã€‹ï¼è¿™æ˜¯æˆ‘æœ€å–œæ¬¢çš„æ­Œä¹‹ä¸€ï½`, 
            2500
        );
        
        setTimeout(() => {
            if (GAME_STATE.aobai.mood > 50) {
                showDialogue('aobai', 
                    `å¥½å‘€ï¼Œä¸ºä½ å”±è¿™é¦–ã€Š${song.title}ã€‹`, 
                    2500
                );
                setTimeout(() => singRandomSong(), 800);
                
                // å¢åŠ åç»­æ„Ÿè°¢ï¼ˆ70%æ¦‚ç‡ï¼‰
                if (Math.random() > 0.3) {
                    setTimeout(() => {
                        showDialogue('lein', "å¤ªæ£’äº†ï¼æœ€çˆ±å¬ä½ å”±æ­Œäº†ï¼", 2000);
                    }, 3500);
                }
            } else {
                showDialogue('aobai', 
                    `ä»Šå¤©æœ‰ç‚¹ç´¯å‘¢...ä¸‹æ¬¡å†å”±ã€Š${song.title}ã€‹ç»™ä½ å¬`, 
                    2500
                );
                
                // å®‰æ…°å›åº”ï¼ˆ50%æ¦‚ç‡ï¼‰
                if (Math.random() > 0.5) {
                    setTimeout(() => {
                        showDialogue('lein', "æ²¡å…³ç³»ï¼ä½ å¥½å¥½ä¼‘æ¯ï¼Œæˆ‘ç­‰ä½ ï½", 2000);
                    }, 1500);
                }
            }
        }, 1200);
    }
    
    function tellJoke() {
        // é›·æ©è®²ç¬‘è¯é€—é³Œæ‹œå¼€å¿ƒ
        const joke = JOKES[Math.floor(Math.random() * JOKES.length)];
        
        showDialogue('lein', joke, 3000);
        
        // ç”Ÿæˆå¼€å¿ƒç²’å­
        createParticleEffect('sparkle', 15,
            window.innerWidth * 0.8, window.innerHeight * 0.7,
            window.innerWidth * 0.2, window.innerHeight * 0.7
        );
        
        setTimeout(() => {
            // é³Œæ‹œååº”
            const reactions = [
                { mood: 15, text: "å™—å“ˆå“ˆ...é›·æ©ä½ è¿™ä¸ªç¬‘è¯å¥½å¥½ç¬‘ï¼", affection: 5 },
                { mood: 10, text: "å“ˆå“ˆå“ˆï½é›·æ©ä½ æ€»æ˜¯è¿™ä¹ˆæœ‰è¶£", affection: 3 },
                { mood: 8, text: "å‘µå‘µ...ä½ å‘€ï¼ŒçœŸä¼šé€—äººå¼€å¿ƒ", affection: 2 },
                { mood: 5, text: "é›·æ©ä½ çš„ç¬‘è¯åº“å­˜çœŸå¤š", affection: 1 }
            ];
            
            const reaction = reactions[Math.floor(Math.random() * reactions.length)];
            
            GAME_STATE.aobai.mood += reaction.mood;
            GAME_STATE.aobai.affection += reaction.affection;
            
            showDialogue('aobai', reaction.text, 2500);
            
            // åç»­äº’åŠ¨ï¼ˆ50%æ¦‚ç‡ï¼‰
            if (Math.random() > 0.5) {
                setTimeout(() => {
                    const followUps = [
                        "æˆ‘è¿˜æœ‰å¥½å¤šç¬‘è¯å‘¢ï¼",
                        "çœ‹åˆ°ä½ ç¬‘æˆ‘å°±å¼€å¿ƒäº†ï¼",
                        "è¦ä¸è¦å†å¬ä¸€ä¸ªï¼Ÿ",
                        "æˆ‘æ˜¯ä¸æ˜¯å¾ˆä¼šé€—ä½ å¼€å¿ƒï¼Ÿ"
                    ];
                    showDialogue('lein', followUps[Math.floor(Math.random() * followUps.length)], 2000);
                }, 1500);
            }
            
            updateMood();
        }, 1800);
    }
    
    function confess() {
        // é›·æ©è¯´æ‚„æ‚„è¯
        if (GAME_STATE.lein.secretFeelings < 30) {
            showDialogue('lein', "æˆ‘...æ²¡ä»€ä¹ˆå•¦ï¼", 2000);
            return;
        }
        
        const confessions = [
            "é³Œæ‹œ...å…¶å®æˆ‘...ï¼ˆå•Šæˆ‘åœ¨è¯´ä»€ä¹ˆï¼‰",
            "æœ‰æ—¶å€™æˆ‘åœ¨æƒ³ï¼Œå¦‚æœ...ä¸ï¼Œæ²¡ä»€ä¹ˆï¼",
            "ä½ å”±æ­Œçš„æ—¶å€™ï¼Œæ˜¯æˆ‘æœ€å¼€å¿ƒçš„æ—¶å€™",
            "èƒ½ä¸èƒ½...æ°¸è¿œåšä½ çš„å¤´å·ç²‰ä¸ï¼Ÿ",
            "æœ‰å¥è¯åœ¨æˆ‘å¿ƒé‡Œå¾ˆä¹…äº†...",
            "ä½ çŸ¥é“å—ï¼Œä½ å¯¹æˆ‘æ¥è¯´å¾ˆç‰¹åˆ«",
            "æœ‰æ—¶å€™æˆ‘ä¼šæƒ³ï¼Œæˆ‘ä»¬çš„å…³ç³»èƒ½ä¸èƒ½...",
            "æˆ‘æ˜¯ä¸æ˜¯å¤ªä¾èµ–ä½ äº†ï¼Ÿ"
        ];
        
        const confession = confessions[Math.floor(Math.random() * confessions.length)];
        
        showDialogue('lein', confession, 3000);
        
        // ç”Ÿæˆç´§å¼ ç²’å­
        createParticleEffect('sparkle', 12,
            window.innerWidth * 0.8, window.innerHeight * 0.7,
            window.innerWidth * 0.2, window.innerHeight * 0.7
        );
        
        setTimeout(() => {
            // é³Œæ‹œååº”
            if (GAME_STATE.aobai.affection < 40) {
                showDialogue('aobai', 
                    "é›·æ©ä½ ä»Šå¤©æ€ä¹ˆæ€ªæ€ªçš„ï¼Ÿæˆ‘ä»¬æ˜¯å¥½æœ‹å‹å‘€ï½", 
                    2500
                );
                GAME_STATE.aobai.mood -= 3;
                GAME_STATE.aobai.affection += 1;
            } else {
                const responses = [
                    "é›·æ©...ä½ å¯¹æˆ‘çœŸçš„å¾ˆç‰¹åˆ«ã€‚è°¢è°¢ä½ ä¸€ç›´é™ªç€æˆ‘",
                    "ä½ æ˜¯æˆ‘æœ€é‡è¦çš„æœ‹å‹...",
                    "æœ‰æ—¶å€™æˆ‘ä¹Ÿåœ¨æƒ³æˆ‘ä»¬çš„å…³ç³»...",
                    "ä½ å¯¹æˆ‘æ¥è¯´ä¹Ÿå¾ˆç‰¹åˆ«ï¼ŒçœŸçš„"
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                
                showDialogue('aobai', response, 3000);
                GAME_STATE.aobai.mood += 5;
                GAME_STATE.aobai.affection += 3;
                GAME_STATE.relationship.intimacy += 5;
            }
            
            GAME_STATE.lein.secretFeelings += 5;
            
            // åç»­å¯¹è¯ï¼ˆ60%æ¦‚ç‡ï¼‰
            if (Math.random() > 0.4) {
                setTimeout(() => {
                    const followUps = [
                        "å¯¹ä¸èµ·...æˆ‘è¯´äº†å¥‡æ€ªçš„è¯",
                        "è¯·å¿˜è®°æˆ‘åˆšæ‰è¯´çš„...",
                        "æˆ‘ä»¬è¿˜æ˜¯åƒä»¥å‰ä¸€æ ·å¥½å—ï¼Ÿ",
                        "æˆ‘æ˜¯ä¸æ˜¯è®©ä½ å›°æ‰°äº†ï¼Ÿ"
                    ];
                    showDialogue('lein', followUps[Math.floor(Math.random() * followUps.length)], 2000);
                }, 2000);
            }
            
            updateMood();
        }, 1500);
    }
    
    // ========== æ–°å¢å‡½æ•°ï¼šè§¦å‘éšæœºå¯¹è¯ ==========
    function triggerRandomDialogue() {
        const actions = [
            () => {
                const character = Math.random() > 0.5 ? 'aobai' : 'lein';
                const dialogueType = character === 'aobai' ? 
                    ['happy', 'touched', 'confused'][Math.floor(Math.random() * 3)] : 
                    ['adoring', 'caring', 'playful'][Math.floor(Math.random() * 3)];
                const dialogues = DIALOGUES[character][dialogueType];
                const randomDialogue = dialogues[Math.floor(Math.random() * dialogues.length)];
                showDialogue(character, randomDialogue);
            },
            () => {
                if (Math.random() > 0.3) singRandomSong();
            },
            () => {
                const jokes = JOKES[Math.floor(Math.random() * JOKES.length)];
                showDialogue('lein', jokes, 3000);
            }
        ];
        
        // éšæœºè§¦å‘1-3ä¸ªåŠ¨ä½œ
        const actionCount = 1 + Math.floor(Math.random() * 3);
        for (let i = 0; i < actionCount; i++) {
            setTimeout(() => {
                const randomAction = actions[Math.floor(Math.random() * actions.length)];
                randomAction();
            }, i * 1500);
        }
    }
    
    // ========== åŠ¨ç”»å¾ªç¯ ==========
    function animate() {
        // æ¸…ç©ºç”»å¸ƒ
        ctx.fillStyle = 'rgba(26, 26, 46, 0.1)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // æ›´æ–°å¹¶ç»˜åˆ¶ç²’å­
        particles = particles.filter(p => p.update());
        particles.forEach(p => p.draw());
        
        requestAnimationFrame(animate);
    }
    
    // ========== åˆå§‹åŒ– ==========
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸµ å¤å¤œçƒŸç«éŸ³ä¹æƒ…ç¼˜ï¼ˆé«˜é¢‘ç‰ˆï¼‰å¯åŠ¨ä¸­...');
        
        // åˆå§‹åŒ–Canvas
        canvas = document.getElementById('canvas');
        ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // ç»‘å®šæŒ‰é’®äº‹ä»¶
        document.getElementById('sendGiftBtn').addEventListener('click', sendGift);
        document.getElementById('requestSongBtn').addEventListener('click', requestSong);
        document.getElementById('tellJokeBtn').addEventListener('click', tellJoke);
        document.getElementById('confessBtn').addEventListener('click', confess);
        
        // è§¦æ‘¸äº‹ä»¶ - æ›´é¢‘ç¹è§¦å‘
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            
            // ç«‹å³è§¦å‘äº’åŠ¨
            const interactions = [sendGift, requestSong, tellJoke, confess, singRandomSong];
            const randomInteraction = interactions[Math.floor(Math.random() * interactions.length)];
            randomInteraction();
            
            // å¯èƒ½è§¦å‘é¢å¤–å¯¹è¯
            if (Math.random() > 0.5) {
                setTimeout(() => {
                    triggerRandomDialogue();
                }, 1000);
            }
        });
        
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            for (let touch of e.touches) {
                createParticleEffect('sparkle', 2, 
                    touch.clientX, touch.clientY,
                    null, null
                );
            }
        });
        
        // é¼ æ ‡äº‹ä»¶ - å¢å¼º
        canvas.addEventListener('mousedown', (e) => {
            if (e.button === 0) { // å·¦é”®
                singRandomSong();
                
                // 50%æ¦‚ç‡è§¦å‘é¢å¤–äº’åŠ¨
                if (Math.random() > 0.5) {
                    setTimeout(() => {
                        const extraActions = [sendGift, tellJoke];
                        extraActions[Math.floor(Math.random() * extraActions.length)]();
                    }, 1200);
                }
            }
        });
        
        canvas.addEventListener('mousemove', (e) => {
            if (e.buttons === 1) { // å·¦é”®æ‹–åŠ¨
                createParticleEffect('sparkle', 2, 
                    e.clientX, e.clientY,
                    null, null
                );
                
                // å¶å°”è§¦å‘å¯¹è¯
                if (Math.random() > 0.9) {
                    const quickDialogues = [
                        "é³Œæ‹œåŠ æ²¹ï¼",
                        "æœ€å–œæ¬¢ä½ äº†ï¼",
                        "ä»Šå¤©ä¹Ÿå¥½å¼€å¿ƒï½",
                        "ä¸€ç›´åœ¨å¬ä½ å”±æ­Œï¼"
                    ];
                    showDialogue('lein', quickDialogues[Math.floor(Math.random() * quickDialogues.length)], 1500);
                }
            }
        });
        
        // çª—å£å¤§å°è°ƒæ•´
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
        
        // æ·»åŠ CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes micPulse {
                0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.4); }
                50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            }
            
            @keyframes floatUp {
                0% { transform: translateY(0) scale(0); opacity: 0; }
                50% { opacity: 1; transform: translateY(-100px) scale(1); }
                100% { transform: translateY(-200px) scale(0); opacity: 0; }
            }
            
            @keyframes sparkle {
                0% { 
                    transform: translate(0, 0) scale(1);
                    opacity: 1;
                }
                100% { 
                    transform: translate(
                        calc(cos(var(--angle)) * var(--distance)),
                        calc(sin(var(--angle)) * var(--distance))
                    ) scale(0);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
        
        // å¼€åœº - æ›´å¤šäº’åŠ¨
        setTimeout(() => {
            showDialogue('aobai', "æ¬¢è¿å¤§å®¶æ¥åˆ°æˆ‘çš„è¯­éŸ³å…ï½ä»Šå¤©ä¹Ÿæ˜¯åŠªåŠ›å”±æ­Œçš„ä¸€å¤©ï¼", 2500);
            
            setTimeout(() => {
                showDialogue('lein', "é³Œæ‹œæˆ‘æ¥å•¦ï¼ä»Šå¤©ä¹Ÿä¸ºä½ æ‰“callï¼", 2000);
                
                // éšæœºæ’­æ”¾ä¸€é¦–æ­Œ
                setTimeout(() => {
                    const initialSong = REAL_SONGS[Math.floor(Math.random() * 2)];
                    document.getElementById('currentSongTitle').textContent = 
                        `æ­£åœ¨æ¼”å”±ï¼šã€Š${initialSong.title}ã€‹`;
                    document.getElementById('currentSongMood').textContent = 
                        `ğŸµ åˆé‡å›å¿† | ${initialSong.artist}`;
                }, 800);
                
                // å¼€åœºé¢å¤–äº’åŠ¨
                setTimeout(() => {
                    showDialogue('aobai', "çœ‹åˆ°é›·æ©æ¥äº†ï¼Œä»Šå¤©è¦å”±ä»€ä¹ˆæ­Œå¥½å‘¢ï¼Ÿ", 2500);
                    
                    setTimeout(() => {
                        showDialogue('lein', "æˆ‘æƒ³å¬ã€Šå‹¾æŒ‡èµ·èª“ã€‹ï¼", 2000);
                        
                        setTimeout(() => {
                            showDialogue('aobai', "å¥½å‘€ï½ä¸ºä½ å”±è¿™é¦–æ­Œï¼", 2000);
                        }, 1200);
                    }, 1500);
                }, 3000);
            }, 1200);
        }, 300);
        
        // å¯åŠ¨åŠ¨ç”»å¾ªç¯
        animate();
        
        // éšæœºè‡ªåŠ¨äº’åŠ¨ - é¢‘ç‡å¤§å¹…æå‡
        setInterval(() => {
            // 80%æ¦‚ç‡è§¦å‘äº’åŠ¨
            if (Math.random() > 0.2) {
                const autoActions = [singRandomSong, sendGift, tellJoke, triggerRandomDialogue];
                const selectedAction = autoActions[Math.floor(Math.random() * autoActions.length)];
                selectedAction();
                
                // 50%æ¦‚ç‡è§¦å‘è¿é”ååº”
                if (Math.random() > 0.5) {
                    setTimeout(() => {
                        const followUpActions = [sendGift, tellJoke, triggerRandomDialogue];
                        followUpActions[Math.floor(Math.random() * followUpActions.length)]();
                    }, 2000);
                }
            }
            
            // æ¯å¤©é€’å¢
            if (Math.random() > 0.9) {
                GAME_STATE.dayCount++;
                document.getElementById('audienceCount').textContent = 
                    Math.floor(1 + GAME_STATE.dayCount * 0.5);
            }
        }, 6000); // 6ç§’ä¸€æ¬¡ï¼Œé¢‘ç‡å¤§å¹…æå‡
        
        // é¢å¤–å®šæ—¶å™¨ï¼šå¶å°”è§¦å‘ç‰¹æ®Šå¯¹è¯
        setInterval(() => {
            if (Math.random() > 0.7) {
                const specialDialogues = [
                    () => showDialogue('aobai', "é›·æ©ï¼Œä½ è¿˜åœ¨å¬å—ï¼Ÿ", 2000),
                    () => showDialogue('lein', "é³Œæ‹œï¼æˆ‘åœ¨ï¼ä¸€ç›´éƒ½åœ¨ï¼", 2000),
                    () => showDialogue('aobai', "è°¢è°¢å¤§å®¶ä¸€ç›´çš„æ”¯æŒ...", 2500),
                    () => showDialogue('lein', "ä½ æ˜¯æˆ‘æ°¸è¿œçš„å¶åƒï¼", 2000)
                ];
                specialDialogues[Math.floor(Math.random() * specialDialogues.length)]();
            }
        }, 12000);
        
        console.log('âœ… é«˜é¢‘ç‰ˆéŸ³ä¹æƒ…ç¼˜å¯åŠ¨å®Œæˆï¼é¢„è®¡å¯¹è¯é¢‘ç‡ï¼šæ¯3-8ç§’ä¸€æ¬¡');
    });
    </script>
</body>
</html>
```
